# 修改说明

我在原来的基础上，基本实现了想象中的公式，

$$
(\alpha \times f_1 + \gamma \times f_2)^2 + \theta \times f_1 + \beta \times f_2
$$

  其中，$\alpha$和$\gamma$生成的方式是`temporal reference parameter generator`。而$\theta$和$\beta$生成的方式是`Appearance reference parameter generator`。具体的生成参数的办法和论文`Relation-Aware Global Attention for Person Re-identification`中类似的。
    
  下面说明论文中的做法，记`feature map`中一个像素中的特征向量为$x_i$。则，可以通过`embeding function`来构建两个对比函数，
$$
r_{ij}= \phi(x_i) \times \theta(x_j) \tag{1}
$$
这样就能构建一个$(WH)\times(WH)$的矩阵。其中和像素块$i$相关的是$r_{i:}$和$r_{:i}$。将这两个$W\times H$的向量拼起来，得到向量$r_i$。即，
$$
r_i = cat(r_{i:},r_{:i})          \tag{2}
$$
将$r_i$和特征向量中的像素特征$x_i$合并得到参考向量，
$$
a_i = cat(\gamma(r_i),\psi(x_i))   \tag{3}
$$
最后，把参考向量用一个门控环节处理得到对应的权重，
$$
\alpha_i = Sigmoid(W_2\times ReLU(W_1\times a_i))   \tag{4}
$$
  在我们的实验中，不同的地方首先是我们是异图对比的，即像素块是在两张不同的图中的。在这个基础上，等式`(1)`，`(2)`我没有做修改。修改的地方在等式`(3)`。我没有把原始特征图中的特征加入权重的计算。为了减小运算代价。即
$$
\alpha_i = Sigmoid(W_2\times ReLU(W_1\times r_i))    \tag{5}
$$


# 实验结果

## experiment-1

|Epoch|Rank1|Rank5|mAP|
|:--:|:--:|:--:|:--:|
|520|88.0|96.0|82.4|
|480|87.9|95.7|82.3|
|440|88.0|95.8|82.3|
|400|88.3|95.9|82.4|

## experiment-2

|Epoch|Rank1|Rank5|mAP|
|:--:|:--:|:--:|:--:|
|520|86.1|94.7|80.5|
|480|86.0|94.1|80.1|
|440|86.6|95.3|81.1|
|400|87.3|95.5|81.9|

## experiment-3

|Epoch|Rank1|Rank5|mAP|
|:--:|:--:|:--:|:--:|
|520|87.1|95.7|82.0|
|480|86.6|95.5|82.0|
|440|86.8|95.8|82.1|
|400|86.7|95.4|81.9|
|360|87.0|95.4|81.8|

## experiment-4

|Epoch|Rank1|Rank5|mAP|
|:--:|:--:|:--:|:--:|
|520|88.0|95.5|82.1|
|480|87.3|95.5|82.1|
|440|87.4|95.8|82.2|
|400|87.4|95.7|82.1|
|360|87.6|95.7|82.1|

# 分析

1、实验结果有点不太稳定，是什么原因造成的？找到了以后，用损失函数进行约束！

2、昨天画`思维导图`想到的，最后使用的门控结构用`Sigmoid`可能有违我们实验的初衷。应该要换成`Tanh`函数，保证生成的参数中有正有负。

3、在描述别人论文的做法中，人家把原始特征图的特征向量也加入了参考向量中，我们应该也是可以这么做的。

4、对于通道参数的生成，可以试试多种方法！